/**
 * @name: Widget Sidebar
 * @author: 稻米鼠
 * @description: A sidebar widget system for Obsidian.
 * @created: 2025-04-17 11:02:34
 * @updated: 6-14-2025, 10:36:55 PM
 * @version: 1.17.1
 */

var at=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var It=Object.getOwnPropertyNames;var At=Object.prototype.hasOwnProperty;var Ht=(a,r)=>{for(var t in r)at(a,t,{get:r[t],enumerable:!0})},Ft=(a,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of It(r))!At.call(a,i)&&i!==t&&at(a,i,{get:()=>r[i],enumerable:!(e=Mt(r,i))||e.enumerable});return a};var Rt=a=>Ft(at({},"__esModule",{value:!0}),a);var Bt={};Ht(Bt,{default:()=>nt});module.exports=Rt(Bt);var E=require("obsidian");var gt=require("obsidian");var pt={simple_edit_modal_save_button_title:"\u4FDD\u5B58",ribbon_button_title:"\u6253\u5F00\u9ED8\u8BA4\u6302\u4EF6\u4FA7\u8FB9\u680F",cannot_create_leaf:"\u65E0\u6CD5\u521B\u5EFA\u65B0\u7684\u4FA7\u8FB9\u680F",command_active_sidebar:"\u6FC0\u6D3B\u6302\u4EF6\u4FA7\u8FB9\u680F",default_widget_header_1_title:"\u5927\u6807\u9898",default_widget_digital_clcok_title:"\u6570\u5B57\u65F6\u949F",default_widget_week_calendar_title:"\u5468\u5386",default_widget_time_progress_title:"\u65F6\u95F4\u8FDB\u5EA6",default_widget_donate_title:"\u5496\u5561\u65F6\u95F4~",default_widget_donate_content:"[\u8BF7\u7ED9\u6211\u4E70\u676F\u5496\u5561~\u2615](https://afdian.com/a/daomishu)",default_view_title:"\u9ED8\u8BA4\u6302\u4EF6\u4FA7\u8FB9\u680F",edit_widget_modal_title:"\u7F16\u8F91\u6302\u4EF6",edit_widget_modal_widget_type_desc:"\u6302\u4EF6\u7C7B\u578B\u51B3\u5B9A\u4E86\u5177\u4F53\u7684\u6E32\u67D3\u65B9\u5F0F\u3002\u8BF7\u53C2\u8003\u63D2\u4EF6\u6587\u6863\u4E86\u89E3\u652F\u6301\u7684\u7C7B\u578B\u3002\u5BF9\u4E8E\u672A\u5217\u51FA\u7684\u7C7B\u578B\uFF0C\u8BE5\u7C7B\u578B\u5C06\u88AB\u89C6\u4E3A\u4EE3\u7801\u8BED\u8A00\uFF0C\u6302\u4EF6\u4EE3\u7801\u5C06\u88AB\u6E32\u67D3\u4E3A\u4EE3\u7801\u5757\u3002\uFF08\u8FD9\u79CD\u65B9\u6CD5\u53EF\u4EE5\u7528\u6765\u8C03\u7528\u5176\u4ED6\u63D2\u4EF6\u8FDB\u884C\u6E32\u67D3\uFF0C\u4F8B\u5982\u4F7F\u7528dataviewjs\u7C7B\u578B\u6765\u6E32\u67D3Dataview\u89C6\u56FE\uFF09",edit_widget_modal_widget_title:"\u6302\u4EF6\u540D\u79F0",edit_widget_modal_widget_title_desc:"\u6302\u4EF6\u540D\u79F0\u4EC5\u7528\u4E8E\u5728\u8BBE\u7F6E\u4E2D\u533A\u5206\u4E0D\u540C\u7684\u6302\u4EF6\u3002",edit_widget_modal_widget_title_placeholder:"\u8BF7\u8F93\u5165\u6302\u4EF6\u540D\u79F0...",edit_widget_modal_widget_type:"\u6302\u4EF6\u7C7B\u578B",edit_widget_modal_widget_custom_type:"\u81EA\u5B9A\u4E49\u7C7B\u578B",edit_widget_modal_widget_custom_type_desc:"\u81EA\u5B9A\u4E49\u7C7B\u578B\u7528\u4E8E\u6E32\u67D3\u5185\u7F6E\u7C7B\u578B\u4E0D\u652F\u6301\u7684\u4EE3\u7801\u5757\u3002\u8BF7\u5728\u6B64\u5904\u8F93\u5165\u8981\u6E32\u67D3\u7684\u4EE3\u7801\u5757\u7C7B\u578B\u3002",edit_widget_modal_widget_custom_type_placeholder:"\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u7C7B\u578B...",edit_widget_modal_widget_style:"\u6302\u4EF6\u6837\u5F0F",edit_widget_modal_widget_style_desc:'\u9009\u62E9\u6302\u4EF6\u7684\u6837\u5F0F\u3002"none"\u8868\u793A\u4E0D\u4F7F\u7528\u989D\u5916\u6837\u5F0F\u3002"default"\u7EE7\u627F\u5168\u5C40\u4FA7\u8FB9\u680F\u6837\u5F0F\u8BBE\u7F6E\u3002',edit_widget_modal_widget_custom_style:"\u81EA\u5B9A\u4E49\u6837\u5F0F",edit_widget_modal_widget_custom_style_desc:'\u4E3A\u6302\u4EF6\u6DFB\u52A0\u81EA\u5B9A\u4E49CSS\u6837\u5F0F\u3002\u6B64\u8BBE\u7F6E\u4EC5\u5728\u6837\u5F0F\u9009\u62E9\u4E3A"custom"\u65F6\u751F\u6548\u3002',edit_widget_modal_widget_custom_style_placeholder:"\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49CSS\u6837\u5F0F...",edit_widget_modal_widget_code:"\u6302\u4EF6\u4EE3\u7801",edit_widget_modal_widget_code_desc:"\u6302\u4EF6\u7684\u5177\u4F53\u4EE3\u7801\u3002\u7F16\u5199\u683C\u5F0F\u6839\u636E\u5177\u4F53\u7C7B\u578B\u800C\u53D8\u5316\uFF0C\u8BF7\u53C2\u8003\u63D2\u4EF6\u6587\u6863\u4E86\u89E3\u8BE6\u60C5\u3002\u5982\u679C\u4F7F\u7528\u7B2C\u4E09\u65B9\u63D2\u4EF6\u6E32\u67D3\u4EE3\u7801\u5757\uFF0C\u60A8\u53EA\u9700\u5728\u6B64\u5904\u7F16\u5199\u4EE3\u7801\u5757\u5185\u7684\u5177\u4F53\u4EE3\u7801\u5373\u53EF\u3002",edit_widget_modal_widget_code_placeholder:"\u8BF7\u8F93\u5165\u6302\u4EF6\u4EE3\u7801...",widget_style_title:"\u6302\u4EF6\u6837\u5F0F",widget_style_selector_title:"\u9009\u62E9\u6302\u4EF6\u6837\u5F0F",widget_style_selector_desc:"\u8FD9\u91CC\u53EA\u5305\u542B\u4E00\u4E9B\u57FA\u7840\u6837\u5F0F\u8BBE\u7F6E\u3002\u5BF9\u4E8E\u590D\u6742\u6548\u679C\uFF0C\u5EFA\u8BAE\u901A\u8FC7CSS\u7247\u6BB5\u5B9E\u73B0\u3002`base`\u8868\u793A\u53EA\u5305\u542B\u6700\u57FA\u672C\u6837\u5F0F\uFF08\u4FBF\u4E8E\u901A\u8FC7css\u7247\u6BB5\u8FDB\u884C\u4E2A\u6027\u5316\u5B9A\u4E49\uFF09\u3002",sidebar_list_title:"\u6302\u4EF6\u8FB9\u680F\u5217\u8868",add_sidebar_button_title:"\u6DFB\u52A0\u4FA7\u8FB9\u680F",new_view_title:"\u65B0\u6302\u4EF6\u4FA7\u8FB9\u680F",sidebar_edit_button_tooltip:"\u7F16\u8F91\u4FA7\u8FB9\u680F",sidebar_delete_button_tooltip:"\u5220\u9664\u4FA7\u8FB9\u680F",delete_default_sidebar_notice:"\u65E0\u6CD5\u5220\u9664\u9ED8\u8BA4\u4FA7\u8FB9\u680F\uFF01",delete_sidebar_button_confirm:"\u786E\u8BA4\u5220\u9664\u8BE5\u4FA7\u8FB9\u680F\uFF1F",add_widget_button_title:"\u6DFB\u52A0\u6302\u4EF6",move_up_button_title:"\u4E0A\u79FB",move_down_button_title:"\u4E0B\u79FB",edit_widget_button_title:"\u7F16\u8F91\u6302\u4EF6",delete_widget_button_title:"\u5220\u9664\u6302\u4EF6",delete_widget_button_title_confirm:"\u786E\u8BA4\u5220\u9664\u8BE5\u6302\u4EF6\uFF1F",widget_type_header_1:"\u5927\u6807\u9898",widget_type_header_1_desc:"\u6E32\u67D3\u4E00\u4E2A\u5927\u6807\u9898",widget_type_header_3:"\u5C0F\u6807\u9898",widget_type_header_3_desc:"\u6E32\u67D3\u4E00\u4E2A\u5C0F\u6807\u9898",widget_type_digital_clock:"\u6570\u5B57\u65F6\u949F",widget_type_digital_clock_desc:"\u6E32\u67D3\u4E00\u4E2A\u6570\u5B57\u65F6\u949F",widget_type_time_progress:"\u65F6\u95F4\u8FDB\u5EA6",widget_type_time_progress_desc:"\u6E32\u67D3\u4E00\u4E2A\u65F6\u95F4\u8FDB\u5EA6\u6761",widget_type_week_calendar:"\u5468\u5386",widget_type_week_calendar_desc:"\u6E32\u67D3\u4E00\u4E2A\u6BCF\u5468\u65E5\u5386\u89C6\u56FE",widget_type_month_calendar:"\u6708\u5386",widget_type_month_calendar_desc:"\u6E32\u67D3\u4E00\u4E2A\u6BCF\u6708\u65E5\u5386\u89C6\u56FE",widget_type_countdown_day:"\u5012\u6570\u65E5",widget_type_countdown_day_desc:"\u663E\u793A\u8DDD\u79BB\u7279\u5B9A\u65E5\u671F\u8FD8\u6709\u591A\u5C11\u5929\u6216\u5DF2\u7ECF\u8FC7\u53BB\u591A\u5C11\u5929",widget_type_text:"\u6587\u672C",widget_type_text_desc:"\u4EE5 Markdown \u683C\u5F0F\u6E32\u67D3\u6587\u672C",widget_type_image:"\u56FE\u7247",widget_type_image_desc:"\u6E32\u67D3\u4E00\u5F20\u56FE\u7247",widget_type_quick_nav:"\u5FEB\u901F\u5BFC\u822A",widget_type_quick_nav_desc:"\u6E32\u67D3\u4E00\u4E2A\u5FEB\u901F\u5BFC\u822A\u680F\uFF0C\u6BCF\u4E2A\u6761\u76EE\u90FD\u662F\u4E00\u4E2A\u94FE\u63A5\u3002\u60A8\u53EF\u4EE5\u5728\u63D2\u4EF6\u6587\u6863\u4E2D\u627E\u5230\u8BE6\u7EC6\u7684\u4F7F\u7528\u8BF4\u660E\u3002",widget_type_year_points:"\u5E74\u5EA6\u70B9\u9635",widget_type_year_points_desc:"\u6E32\u67D3\u4E00\u4E2A\u5E74\u5EA6\u70B9\u9635\u8FDB\u5EA6\u6761\uFF0C\u7528\u4E8E\u663E\u793A\u5F53\u524D\u5E74\u4EFD\u7684\u8FDB\u5EA6",widget_type_file_stats:"\u6587\u4EF6\u7EDF\u8BA1",widget_type_file_stats_desc:"\u663E\u793A\u4ED3\u5E93\u4E2D\u4E0D\u540C\u7C7B\u578B\u6587\u4EF6\u7684\u6570\u91CF\u7EDF\u8BA1\uFF0Ccode \u53EF\u4EE5\u5305\u542B\u8981\u6392\u9664\u7684\u5185\u5BB9\uFF0C\u6BCF\u884C\u4E00\u4E2A\u9879\u76EE\u3002\u5982\u679C\u7B14\u8BB0\u8DEF\u5F84\u4EE5\u4EFB\u4F55\u9879\u76EE\u5185\u5BB9\u5F00\u5934\uFF0C\u8BE5\u7B14\u8BB0\u5C06\u88AB\u6392\u9664",widget_type_working_time_progress:"\u5DE5\u4F5C\u65F6\u95F4\u8FDB\u5EA6",widget_type_working_time_progress_desc:"\u663E\u793A\u4E00\u5929\u4E2D\u7684\u5DE5\u4F5C\u65F6\u95F4\u8FDB\u5EA6",widget_type_random_notes:"\u968F\u673A\u7B14\u8BB0",widget_type_random_notes_desc:"\u663E\u793A\u4ED3\u5E93\u4E2D\u7684\u968F\u673A\u7B14\u8BB0\uFF0Ccode \u53EF\u4EE5\u5305\u542B\u8981\u6392\u9664\u7684\u5185\u5BB9\uFF0C\u6BCF\u884C\u4E00\u4E2A\u9879\u76EE\u3002\u5982\u679C\u7B14\u8BB0\u8DEF\u5F84\u4EE5\u4EFB\u4F55\u9879\u76EE\u5185\u5BB9\u5F00\u5934\uFF0C\u8BE5\u7B14\u8BB0\u5C06\u88AB\u6392\u9664",widget_type_battery_status:"\u7535\u6C60\u72B6\u6001",widget_type_battery_status_desc:"\u663E\u793A\u8BBE\u5907\u7535\u91CF\u548C\u5145\u7535\u72B6\u6001",widget_type_daily_event_record:"\u65E5\u5E38\u4E8B\u4EF6\u8BB0\u5F55",widget_type_daily_event_record_desc:"\u8BB0\u5F55\u5E76\u663E\u793A\u65E5\u5E38\u4E8B\u4EF6\u5B8C\u6210\u65F6\u95F4",widget_type_countdown_timer:"\u5012\u8BA1\u65F6\u5668",widget_type_countdown_timer_desc:"\u663E\u793A\u4E00\u4E2A\u5012\u8BA1\u65F6\u5668\uFF0C\u60A8\u53EF\u4EE5\u8BBE\u7F6E\u5012\u8BA1\u65F6\u65F6\u95F4\u3002\u5982\u679C\u9700\u8981\u4F7F\u7528\u9884\u8BBE\u65F6\u95F4\uFF0C\u8BF7\u8F93\u5165\u6BCF\u884C\u4E00\u4E2A\u9884\u8BBE\u65F6\u95F4\u3002\u5982\u679C\u672A\u8BBE\u7F6E\u9884\u8BBE\uFF0C\u5C06\u4F7F\u7528\u9ED8\u8BA4\u9884\u8BBE\uFF081\u5206\u949F\u30013\u5206\u949F\u30015\u5206\u949F\uFF09\u3002",countdown_unnamed_event:"\u672A\u547D\u540D\u4E8B\u4EF6",countdown_future_prefix:"\u8DDD\u79BB ",countdown_future_suffix:"",countdown_day_singular:"\u5929",countdown_day_plural:"\u5929",countdown_today_prefix:"\u4ECA\u5929\u662F ",countdown_today_suffix:"",countdown_today:"\u4ECA\u5929",countdown_past_prefix:"",countdown_past_suffix:" \u5DF2\u7ECF\u8FC7\u53BB",daily_event_record_default_title:"\u65E5\u5E38\u4E8B\u4EF6\u8BB0\u5F55",daily_event_record_no_note:"\u8BF7\u5728\u914D\u7F6E\u4E2D\u6307\u5B9A\u7B14\u8BB0",daily_event_record_load_error:"\u52A0\u8F7D\u8BB0\u5F55\u6570\u636E\u5931\u8D25",daily_event_record_today_title:"\u4ECA\u65E5\u8BB0\u5F55",daily_event_record_edit_tooltip:"\u7F16\u8F91\u8BB0\u5F55",daily_event_record_delete_tooltip:"\u5220\u9664\u8BB0\u5F55",daily_event_record_no_records:"\u6682\u65E0\u8BB0\u5F55",daily_event_record_add_button:"\u6DFB\u52A0\u8BB0\u5F55",daily_event_record_add_success:"\u8BB0\u5F55\u5DF2\u6DFB\u52A0",daily_event_record_add_error:"\u6DFB\u52A0\u8BB0\u5F55\u5931\u8D25",daily_event_record_edit_success:"\u8BB0\u5F55\u5DF2\u66F4\u65B0",daily_event_record_edit_error:"\u7F16\u8F91\u8BB0\u5F55\u5931\u8D25",daily_event_record_invalid_time:"\u65F6\u95F4\u683C\u5F0F\u65E0\u6548\uFF0C\u8BF7\u4F7F\u7528 HH:mm \u683C\u5F0F\u5F00\u5934",daily_event_record_delete_confirm:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u6761\u8BB0\u5F55\u5417\uFF1F",daily_event_record_delete_success:"\u8BB0\u5F55\u5DF2\u5220\u9664",daily_event_record_delete_error:"\u5220\u9664\u8BB0\u5F55\u5931\u8D25",random_notes_title:"\u968F\u673A\u7B14\u8BB0",random_notes_refresh_tooltip:"\u5237\u65B0\u968F\u673A\u7B14\u8BB0",working_time_progress_minute:"\u5206\u949F",working_time_progress_hour:"\u5C0F\u65F6",working_time_progress_working:"\u5DE5\u4F5C\u4E2D",working_time_progress_resting:"\u4F11\u606F\u4E2D",working_time_progress_working_is_remaining:"\u5269\u4F59"};var mt={simple_edit_modal_save_button_title:"Save",ribbon_button_title:"Open default widget sidebar",cannot_create_leaf:"Could not create a new Sidebar",command_active_sidebar:"Activve widget sidebar",default_widget_header_1_title:"Big title",default_widget_digital_clcok_title:"Digital Clock",default_widget_week_calendar_title:"Week Calendar",default_widget_time_progress_title:"Time Progress",default_widget_donate_title:"Coffee time~",default_widget_donate_content:"[Pls buy me a cup of coffee~\u2615](https://afdian.com/a/daomishu)",default_view_title:"Default widget sidebar",edit_widget_modal_title:"Edit Widget",edit_widget_modal_widget_type_desc:"The widget type determines the specific rendering method. Please refer to the plugin documentation for supported types. For unlisted types, the type will be treated as a code language and the widget code will be rendered as a code block. (This method can be used to invoke other plugins for rendering, such as using the dataviewjs type to render Dataview views)",edit_widget_modal_widget_title:"Widget Name",edit_widget_modal_widget_title_desc:"The widget name is only used to distinguish widgets in settings.",edit_widget_modal_widget_title_placeholder:"Enter widget name...",edit_widget_modal_widget_type:"Widget Type",edit_widget_modal_widget_custom_type:"Custom Type",edit_widget_modal_widget_custom_type_desc:"The custom type is used to render code blocks that are not supported by the built-in types. Please enter the type of the code block you want to render here.",edit_widget_modal_widget_custom_type_placeholder:"Enter custom type...",edit_widget_modal_widget_style:"Widget Style",edit_widget_modal_widget_style_desc:'Choose the style for this widget. "none" means no additional styles. "default" inherits global sidebar style settings.',edit_widget_modal_widget_custom_style:"Custom Style",edit_widget_modal_widget_custom_style_desc:'Enter a custom style for the widget. This will only take effect when the style is set to "custom".',edit_widget_modal_widget_custom_style_placeholder:"Enter custom style...",edit_widget_modal_widget_code:"Widget Code",edit_widget_modal_widget_code_desc:"The specific code for the widget. The writing format varies depending on the specific type, please refer to the plugin documentation for details. If using third-party plugins to render code blocks, you only need to write the specific code within the code block here.",edit_widget_modal_widget_code_placeholder:"Enter widget code...",widget_style_title:"Widget Style",widget_style_selector_title:"Choice Widget Style",widget_style_selector_desc:"This only includes some basic style settings. For complex effects, it is recommended to implement them through CSS snippets. `base` means including only basic styles (convenient for personalization through CSS snippets).",sidebar_list_title:"Widget sidebar list",add_sidebar_button_title:"Add new widget sidebar",new_view_title:"New widget sidebar",sidebar_edit_button_tooltip:"Edit sidebar",sidebar_delete_button_tooltip:"Delete sidebar",delete_default_sidebar_notice:"Cannot delete the default sidebar!",delete_sidebar_button_confirm:"Are you sure you want to delete this sidebar?",add_widget_button_title:"Add Widget",move_up_button_title:"Move Up",move_down_button_title:"Move Down",edit_widget_button_title:"Edit Widget",delete_widget_button_title:"Delete Widget",delete_widget_button_title_confirm:"Are you sure you want to delete this widget?",widget_type_header_1:"Big title",widget_type_header_1_desc:"Render a big title",widget_type_header_3:"Sub title",widget_type_header_3_desc:"Render a sub title",widget_type_digital_clock:"Digital Clock",widget_type_digital_clock_desc:"Render a digital clock",widget_type_time_progress:"Time Progress",widget_type_time_progress_desc:"Render a time progress bar",widget_type_week_calendar:"Week Calendar",widget_type_week_calendar_desc:"Render a weekly calendar view",widget_type_month_calendar:"Month Calendar",widget_type_month_calendar_desc:"Render a monthly calendar view",widget_type_countdown_day:"Countdown Day",widget_type_countdown_day_desc:"Display days remaining until or passed since a specific date",widget_type_text:"Text",widget_type_text_desc:"Render text as markdown",widget_type_image:"Image",widget_type_image_desc:"Render an image",widget_type_quick_nav:"Quick Nav",widget_type_quick_nav_desc:"Render a quick navigation bar, each item is a link. You can find detailed usage instructions in the plugin documentation.",widget_type_year_points:"Year Points",widget_type_year_points_desc:"Render a year progress bar",widget_type_file_stats:"File Stats",widget_type_file_stats_desc:"Display statistics of different file types in the Vault, code can include content to exclude, one item per line. If a note path starts with any item content, that note will be excluded",widget_type_working_time_progress:"Working Time Progress",widget_type_working_time_progress_desc:"Display the progress of working time in a day",widget_type_random_notes:"Random Notes",widget_type_random_notes_desc:"Display random notes from the Vault, code can include content to exclude, one item per line. If a note path starts with any item content, that note will be excluded",widget_type_battery_status:"Battery Status",widget_type_battery_status_desc:"Display device battery level and charging status",widget_type_daily_event_record:"Daily Event Record",widget_type_daily_event_record_desc:"Record and display daily event completion times",widget_type_countdown_timer:"Countdown Timer",widget_type_countdown_timer_desc:"Display a countdown timer, you can set the countdown time. If you want to use presets, please enter the preset times, one per line. If no presets are set, the default presets will be used (1 minute, 3 minutes, 5 minutes).",countdown_unnamed_event:"Unnamed Event",countdown_future_prefix:"Until ",countdown_future_suffix:"",countdown_day_singular:"day",countdown_day_plural:"days",countdown_today_prefix:"Today is ",countdown_today_suffix:"",countdown_today:"Today",countdown_past_prefix:"",countdown_past_suffix:" has passed for",daily_event_record_default_title:"Daily Event Record",daily_event_record_no_note:"Please specify a note in the configuration",daily_event_record_load_error:"Failed to load record data",daily_event_record_today_title:"Today's Records",daily_event_record_edit_tooltip:"Edit Record",daily_event_record_delete_tooltip:"Delete Record",daily_event_record_no_records:"No records",daily_event_record_add_button:"Add Record",daily_event_record_add_success:"Record added",daily_event_record_add_error:"Failed to add record",daily_event_record_edit_success:"Record updated",daily_event_record_edit_error:"Failed to edit record",daily_event_record_invalid_time:"Invalid time format, please use HH:mm format at start",daily_event_record_delete_confirm:"Are you sure you want to delete this record?",daily_event_record_delete_success:"Record deleted",daily_event_record_delete_error:"Failed to delete record",random_notes_title:"Random Notes",random_notes_refresh_tooltip:"Refresh Random Notes",working_time_progress_minute:"minute(s)",working_time_progress_hour:"hour(s)",working_time_progress_working:"Working",working_time_progress_resting:"Resting",working_time_progress_working_is_remaining:"remaining"};var dt={zh:pt,en:mt},lt=(0,gt.getLanguage)();dt[lt]||(lt="en");function o(a,r){return r===void 0&&(r=a),dt[lt][a]||dt.en[a]||r}var W={configVersion:2,global:{sidebarStyle:"card"},sidebars:{default:{title:"\u9ED8\u8BA4",viewType:"default",widgets:[{title:o("default_widget_header_1_title","\u9ED8\u8BA4\u6807\u9898"),type:"header_1",style:"default",code:"Hello World!"},{title:o("default_widget_digital_clcok_title","\u6570\u5B57\u65F6\u949F"),type:"digital_clock",style:"default",code:""},{title:o("default_widget_week_calendar_title","\u5468\u5386"),type:"week_calendar",style:"default",code:""},{title:o("default_widget_time_progress_title","\u65F6\u95F4\u8FDB\u5EA6"),type:"time_progress",style:"default",code:""},{title:o("default_widget_donate_title","\u6350\u8D60"),type:"text",style:"default",code:o("default_widget_donate_content","\u5982\u679C\u60A8\u559C\u6B22\u8FD9\u4E2A\u63D2\u4EF6\uFF0C\u8BF7\u8003\u8651\u6350\u8D60\u652F\u6301\u5F00\u53D1\u8005\u3002")}]}}};var _t=a=>{if("widgets"in a){let r=[...a.widgets];Object.assign(a,{configVersion:2,sidebars:{default:{title:o("default_view_title","\u9ED8\u8BA4\u89C6\u56FE"),viewType:"default",widgets:r}}}),delete a.widgets}return"sidebarStyle"in a&&(Object.assign(a,{global:{sidebarStyle:a.sidebarStyle}}),delete a.sidebarStyle),a};var _=require("obsidian");var R=require("obsidian"),m=class extends R.Component{constructor(t,e,i){super();this.app=i,this.container=t,this.widget=e,this.container.empty()}async markdownRender(t,e){await R.MarkdownRenderer.render(this.app,e,t,"",this)}createLink(t,e,i,s=[]){return i.createEl("a",{cls:["internal-link"].concat(s).join(" "),href:t,text:e,attr:{rel:"noopener",target:"_blank"}})}},S=class extends m{constructor(t,e,i){super(t,e,i);this.progress=0;this.direction="horizontal";this.align="start";this.container.classList.add("dms-sidebar-progress-widget"),this.progressBar=this.container.createDiv("dms-sidebar-progress-widget-bar")}setDirection(t,e="start"){this.direction=t,this.align=e,this.progressBar.dataset.direction=t,this.progressBar.dataset.align=e,this.progressBar.setAttribute("style",`${this.direction==="horizontal"?"width":"height"}: ${this.progress}%`)}setProgress(t){this.progress=t,this.progressBar.setAttribute("style",`${this.direction==="horizontal"?"width":"height"}: ${this.progress}%`),this.progressBar.dataset.level=this.getLevel(this.progress)}getLevel(t){return t>=100?"100":t>=80?"80":t>=60?"60":t>=40?"40":t>=20?"20":"0"}};var P=class extends m{constructor(r,t,e){super(r,t,e)}onload(){let r="```"+this.widget.type+`
`+this.widget.code+"\n```";this.markdownRender(this.container,r)}};var M=class extends m{constructor(r,t,e){super(r,t,e)}onload(){var t;let r=((t=this.widget.type.match(/(\d)$/))==null?void 0:t[1])||"3";this.container.createEl(`h${r}`,{text:this.widget.code,cls:`dms-widget-header dms-widget-header-${r}`})}};var D=class{constructor(r,t=!1){this.listeners=new Map;this.state=r,this.initialState={...r},this.canReset=t}static getInstance(r,t,e){return!D.instances.has(r)&&t&&D.instances.set(r,new D(t,e)),D.instances.get(r)}getState(){return{...this.state}}async updateState(r){let t={...this.state,...r};Object.keys(r).forEach(e=>{r[e]===void 0&&delete t[e]}),this.state=t,await this.notifyListeners(r)}subscribe(r,t){return this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(t),()=>{let e=this.listeners.get(r);e&&(e.delete(t),e.size===0&&this.listeners.delete(r))}}async notifyListeners(r){let t=Object.keys(r),e=new Set;for(let s of t){let n=this.listeners.get(s);if(n)for(let d of n)e.has(d)||(await d(),e.add(d))}let i=this.listeners.get("");if(i)for(let s of i)e.has(s)||(await s(),e.add(s))}clearAllSubscriptions(){this.listeners.clear()}reset(){if(!this.canReset)throw new Error("\u6B64Store\u5B9E\u4F8B\u4E0D\u5141\u8BB8\u91CD\u7F6E");this.state={...this.initialState},this.clearAllSubscriptions()}},x=D;x.instances=new Map;var w=x.getInstance("global",W.global),g=x.getInstance("sidebars",W.sidebars),l=x.getInstance("timer",{},!0);var $=class extends m{constructor(t,e,i){super(t,e,i);this.els=[];this.subscription=[]}updateTimeDisplay(){var e;let t=(e=l.getState().moment)==null?void 0:e.clone();t&&(t.format("HH").split("").forEach((i,s)=>{this.els[s].setText(i)}),t.format("mm").split("").forEach((i,s)=>{this.els[s+3].setText(i)}),this.els[2].toggleClass("blink",t.second()%2===0))}onload(){this.els="00:00".split("").map(t=>this.container.createEl("span",{cls:"dms-digital-clock-digit",text:t})),this.updateTimeDisplay(),this.subscription.push(l.subscribe("second",()=>{this.updateTimeDisplay()}))}onunload(){this.subscription.forEach(t=>t())}};var B=class extends m{constructor(r,t,e){super(r,t,e)}onload(){this.markdownRender(this.container,this.widget.code)}};var ht=require("obsidian"),N=class extends ht.Component{constructor(t,e){super();this.titleEl=null;this.precentEl=null;this.container=t.createDiv(e.cls?["dms-sidebar-progress-bar-wrapper"].concat(e.cls).join(" "):"dms-sidebar-progress-wrapper"),e.title&&(this.titleEl=this.container.createEl("div",{text:e.title,cls:"dms-sidebar-progress-bar-title"})),this.progressTrack=this.container.createDiv("dms-sidebar-progress-bar-track"),this.progressIndicator=this.progressTrack.createDiv("dms-sidebar-progress-bar-indicator"),e.precent&&(this.precentEl=this.container.createEl("div",{text:e.precent,cls:"dms-sidebar-progress-bar-precent"})),this.setProgress(e.progress)}setTitle(t){this.titleEl&&this.titleEl.setText(t)}setProgress(t){this.progressIndicator.setAttribute("style",`width: ${t}%`),this.progressIndicator.dataset.level=this.getLevel(t),this.setPrecent(`${t}%`)}setPrecent(t){this.precentEl&&this.precentEl.setText(t)}getLevel(t){return t>=100?"100":t>=80?"80":t>=60?"60":t>=40?"40":t>=20?"20":"0"}};var O=class extends m{constructor(t,e,i){super(t,e,i);this.items=[];this.subscription=[]}calculateProgress(t,e){let i=t.clone().startOf(e.toLowerCase()),s=t.clone().endOf(e.toLowerCase());return(t.valueOf()-i.valueOf())/(s.valueOf()-i.valueOf())*100}updateProgressUI(t){this.items.forEach(e=>{var s;let i=this.calculateProgress(t,e.type);(s=e.progressbar)==null||s.setProgress(parseFloat(i.toFixed(2)))})}onload(){var e;this.items=["Year","Month","Week","Day"].map(i=>({type:i,progressbar:new N(this.container,{title:i,progress:0,precent:"0%",cls:["dms-time-progress-item",`dms-time-progress-item-${i.toLowerCase()}`,"dms-sidebar-progress-level-reverse"]})}));let t=(e=l.getState().moment)==null?void 0:e.clone();t&&this.updateProgressUI(t),this.subscription.push(l.subscribe("minute",()=>{var s;let i=(s=l.getState().moment)==null?void 0:s.clone();i&&this.updateProgressUI(i)}))}onunload(){this.subscription.forEach(t=>t())}};var ut=require("obsidian");var V=class extends m{constructor(t,e,i){super(t,e,i);this.weekDays=[];this.dates=[];this.subscription=[]}updateCalendarDisplay(t){if(!t)return;let e=t.day(),i=t.date(),s=t.clone().subtract(e,"days");for(let n=0;n<7;n++){let d=s.clone().add(n,"days"),p=d.format("DD");this.dates[n].setText(p),(0,ut.setTooltip)(this.dates[n],d.format("YYYY-MM-DD"),{placement:"top"}),this.dates[n].toggleClass("dms-sidebar-week-calendar-current",+p===i)}}onload(){var i;let t=this.container.createDiv({cls:"dms-sidebar-week-calendar-row"});this.weekDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>t.createSpan({cls:"dms-sidebar-week-calendar-weekday",text:s}));let e=this.container.createDiv({cls:"dms-sidebar-week-calendar-row"});this.dates=Array(7).fill(null).map(()=>e.createSpan({cls:"dms-sidebar-week-calendar-date"})),this.updateCalendarDisplay((i=l.getState().moment)==null?void 0:i.clone()),this.subscription.push(l.subscribe("hours",()=>{var s;this.updateCalendarDisplay((s=l.getState().moment)==null?void 0:s.clone())}))}onunload(){this.subscription.forEach(t=>t())}};var ft=require("obsidian");var Y=class extends m{constructor(t,e,i){super(t,e,i);this.subscription=[]}updateCalendarDisplay(t){if(!t)return;let e=t.year(),i=t.month(),s=t.date();this.yearMonthEl.setText(`${e}-${String(i+1).padStart(2,"0")}`);let n=t.clone().startOf("month"),d=n.day(),p=t.daysInMonth();this.dateGrid.empty();let c=-d+1;for(let h=0;h<6;h++){let f=this.dateGrid.createDiv({cls:"dms-sidebar-month-calendar-row"});if(c>p)break;for(let y=0;y<7;y++){let b=f.createSpan({cls:"dms-sidebar-month-calendar-date"});if(c<=0||c>p){c++;continue}let Lt=String(c).padStart(2,"0");b.setText(Lt);let Wt=n.clone().add(c-1,"days");(0,ft.setTooltip)(b,Wt.format("YYYY-MM-DD"),{placement:"top"}),i===t.month()&&c===s&&b.addClass("dms-sidebar-month-calendar-current"),c++}if(c>p)break}}onload(){var i;let t=this.container.createDiv({cls:"dms-sidebar-month-calendar-header"});this.yearMonthEl=t.createSpan({cls:"dms-sidebar-month-calendar-yearmonth"});let e=this.container.createDiv({cls:"dms-sidebar-month-calendar-weekdays"});["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(s=>{e.createSpan({cls:"dms-sidebar-month-calendar-weekday",text:s})}),this.dateGrid=this.container.createDiv({cls:"dms-sidebar-month-calendar-grid"}),this.updateCalendarDisplay((i=l.getState().moment)==null?void 0:i.clone()),this.subscription.push(l.subscribe("day",()=>{var s;this.updateCalendarDisplay((s=l.getState().moment)==null?void 0:s.clone())}))}onunload(){this.subscription.forEach(t=>t())}};var I=require("obsidian");var j=class extends m{constructor(t,e,i){super(t,e,i);this.subscription=[];this.config=this.getConfig(e.code)}getConfig(t){let e={name:o("countdown_unnamed_event","\u672A\u547D\u540D\u4E8B\u4EF6"),date:(0,I.moment)().format("YYYY-MM-DD")};if(!t||t.trim()==="")return e;try{return(0,I.parseYaml)(t)}catch(i){return console.error("\u89E3\u6790YAML\u5931\u8D25:",i),e}}calculateDaysDifference(t,e){return t.startOf("day").diff(e.startOf("day"),"days")}updateDisplay(t){if(!t)return;let e=(0,I.moment)(this.config.date,"YYYY-MM-DD"),i=this.calculateDaysDifference(e,t);if(i>0)this.messageEl.setText(o("countdown_future_prefix","\u8DDD\u79BB ")+this.config.name+o("countdown_future_suffix"," \u8FD8\u6709")),this.daysCountEl.setText(String(i)),this.daysCountEl.dataset.status="future",this.daysCountEl.setAttribute("style",`font-size: calc(var(--dms-sidebar-width) / ${String(i).length/2+2})`),this.daysUnitEl.setText(i===1?o("countdown_day_singular","\u5929"):o("countdown_day_plural","\u5929"));else if(i===0)this.messageEl.setText(o("countdown_today_prefix","\u4ECA\u5929\u662F ")+this.config.name+o("countdown_today_suffix","")),this.daysCountEl.setText(o("countdown_today","\u4ECA\u5929")),this.daysCountEl.dataset.status="today",this.daysUnitEl.setText("");else{this.messageEl.setText(o("countdown_past_prefix","")+this.config.name+o("countdown_past_suffix"," \u5DF2\u7ECF\u8FC7\u53BB"));let s=Math.abs(i);this.daysCountEl.setText(String(s)),this.daysCountEl.dataset.status="past",this.daysCountEl.setAttribute("style",`font-size: calc(var(--dms-sidebar-width) / ${String(s).length/2+2})`),this.daysUnitEl.setText(s===1?o("countdown_day_singular","\u5929"):o("countdown_day_plural","\u5929"))}}onload(){var e;this.messageEl=this.container.createDiv({cls:"dms-sidebar-countdown-day-message"}),this.daysEl=this.container.createDiv({cls:"dms-sidebar-countdown-day-days"}),this.daysCountEl=this.daysEl.createSpan({cls:"dms-sidebar-countdown-day-days-count"}),this.daysUnitEl=this.daysEl.createSpan({cls:"dms-sidebar-countdown-day-days-unit"});let t=(e=l.getState().moment)==null?void 0:e.clone();t&&this.updateDisplay(t),this.subscription.push(l.subscribe("day",()=>{var s;let i=(s=l.getState().moment)==null?void 0:s.clone();i&&this.updateDisplay(i)}))}onunload(){this.subscription.forEach(t=>t())}};var yt=require("obsidian"),z=class extends m{constructor(r,t,e){super(r,t,e)}getImgUrl(r){if(r=r.trim(),r.startsWith("http"))return r;let t=(0,yt.normalizePath)(r);return this.app.vault.adapter.getResourcePath(t)}onload(){this.container.createEl("img",{attr:{src:this.getImgUrl(this.widget.code)}})}};var q=require("obsidian");var U=class extends m{constructor(r,t,e){super(r,t,e)}onload(){this.parseNavItems(this.widget.code).forEach(t=>this.createNavItem(this.container,t))}parseNavItems(r){return r.split(`
`).filter(t=>t.trim()).map(t=>{let e=t.split("|").map(p=>p.trim()),[i="",s="",n=""]=e,d=this.getIconType(s);return{description:i,icon:s,link:n,iconType:d}})}getIconType(r){return r.match(/^https?:\/\/.+/)||r.match(/\.\w+$/i)?"img":r.match(/^[a-zA-Z0-9-]+$/)?"icon":"emoji"}createNavItem(r,t){let e=this.createLink(t.link,"",r,["dms-sidebar-quick-nav-item",`dms-sidebar-quick-nav-item-${t.iconType}`]);(0,q.setTooltip)(e,t.description,{placement:"top"}),t.iconType==="img"?e.createEl("img",{cls:"dms-sidebar-quick-nav-icon",attr:{src:t.icon}}):t.iconType==="icon"?(0,q.setIcon)(e,t.icon):e.setText(t.icon)}};var A=require("obsidian");var G=class extends m{constructor(t,e,i){super(t,e,i);this.subscription=[]}updateDisplay(t){let e=t.year(),s=(0,A.moment)([e]).isLeapYear()?366:365,n=t.dayOfYear(),d=(n/s*100).toFixed(1);this.yearText.setText(String(e)),this.progressText.setText(` ${d}%`),this.pointsContainer.empty();for(let p=1;p<=s;p++){let c=["dms-sidebar-year-points-day",...p<n?["dms-sidebar-year-points-past"]:[],...p===n?["dms-sidebar-year-points-today"]:[]].join(" "),h=this.pointsContainer.createDiv({cls:c});(0,A.setTooltip)(h,`${(0,A.moment)([e]).dayOfYear(p).format("MM-DD")} (${p}/${s})`,{placement:"top"})}}onload(){var e;this.yearContainer=this.container.createDiv({cls:"dms-sidebar-year-points-header"}),this.yearText=this.yearContainer.createSpan({cls:"dms-sidebar-year-points-year"}),this.progressText=this.yearContainer.createSpan({cls:"dms-sidebar-year-points-progress"}),this.pointsContainer=this.container.createDiv({cls:"dms-sidebar-year-points-grid"});let t=(e=l.getState().moment)==null?void 0:e.clone();t&&this.updateDisplay(t),this.subscription.push(l.subscribe("day",()=>{var s;let i=(s=l.getState().moment)==null?void 0:s.clone();i&&this.updateDisplay(i)}))}onunload(){this.subscription.forEach(t=>t())}};var Q=class extends m{constructor(r,t,e){super(r,t,e)}onload(){let r=this.app.vault.getFiles(),t=this.widget.code.split(`
`).map(s=>s.trim()).filter(s=>s.length>0),e=r.filter(s=>{let n=s.path;return!t.some(d=>n.startsWith(d))}),i=this.getFileStats(e).filter(s=>s.count>0);i.sort((s,n)=>n.count-s.count),i.forEach(s=>this.createStatItem(s))}getFileStats(r){let t=[{type:"total",icon:"\u{1F4CA}",count:r.length,description:"Total"},{type:"markdown",icon:"\u{1F4DD}",count:r.filter(i=>i.extension==="md").length,description:"Note"},{type:"image",icon:"\u{1F5BC}\uFE0F",count:r.filter(i=>["png","jpg","jpeg","gif","bmp","svg"].includes(i.extension)).length,description:"Image"},{type:"code",icon:"\u{1F468}\u200D\u{1F4BB}",count:r.filter(i=>["js","css","json","yaml","yml","ts","html"].includes(i.extension)).length,description:"Code"},{type:"audio",icon:"\u{1F3B5}",count:r.filter(i=>["mp3","wav","ogg","m4a","flac","aac"].includes(i.extension)).length,description:"Audio"},{type:"video",icon:"\u{1F3AC}",count:r.filter(i=>["mp4","webm","mkv","avi","mov","flv"].includes(i.extension)).length,description:"Video"},{type:"pdf",icon:"\u{1F4DA}",count:r.filter(i=>i.extension==="pdf").length,description:"PDF"},{type:"document",icon:"\u{1F4D1}",count:r.filter(i=>["doc","docx","xls","xlsx","ppt","pptx","txt","rtf"].includes(i.extension)).length,description:"Document"},{type:"archive",icon:"\u{1F5C4}\uFE0F",count:r.filter(i=>["zip","rar","7z","tar","gz"].includes(i.extension)).length,description:"Archive"}],e=new Map;return r.forEach(i=>{let s=i.extension;s&&!["md","png","jpg","jpeg","gif","bmp","svg","js","css","json","yaml","yml","ts","html","mp3","wav","ogg","m4a","flac","aac","mp4","webm","mkv","avi","mov","flv","pdf","doc","docx","xls","xlsx","ppt","pptx","txt","rtf","zip","rar","7z","tar","gz"].includes(s)&&e.set(s,(e.get(s)||0)+1)}),e.forEach((i,s)=>{t.push({type:s,icon:"\u{1F4C4}",count:i,description:`.${s}`})}),t}createStatItem(r){let t=this.container.createEl("div",{cls:"dms-sidebar-file-stat-item"}),e=t.createEl("span",{cls:"dms-sidebar-file-stat-type"});e.createEl("span",{text:r.icon,cls:"dms-sidebar-file-stat-icon"}),e.createEl("span",{text:r.description,cls:"dms-sidebar-file-stat-desc"}),t.createEl("span",{text:String(r.count),cls:"dms-sidebar-file-stat-count"})}};var T=require("obsidian");var Z=class extends S{constructor(t,e,i){super(t,e,i);this.subscription=[];this.config=this.getConfig(this.widget.code)}getConfig(t){let e={startTime:"09:00",endTime:"18:00"};if(!t||t.trim()==="")return e;try{return(0,T.parseYaml)(t)}catch(i){return console.error("\u89E3\u6790YAML\u5931\u8D25:",i),e}}formatRemainingTime(t){if(t<60)return`${t} ${o("working_time_progress_minute","\u5206\u949F")}`;let e=Math.floor(t/60),i=t%60;return`${e} ${o("working_time_progress_hour","\u5C0F\u65F6")} ${i} ${o("working_time_progress_minute","\u5206\u949F")}`}calculateWorkProgress(t){let e=(0,T.moment)(t),i=(0,T.moment)(t).startOf("day").add(T.moment.duration(this.config.startTime)),s=(0,T.moment)(t).startOf("day").add(T.moment.duration(this.config.endTime)),n=!1;(s.isBefore(i)||this.config.endTime.startsWith("+"))&&(s.add(1,"day"),n=!0),n&&e.isBefore(s)&&e.isBefore(i)&&(i.subtract(1,"day"),s.subtract(1,"day"));let d=e.isBetween(i,s,null,"[]"),p=0,c=0;return d?(p=(e.valueOf()-i.valueOf())/(s.valueOf()-i.valueOf())*100,c=Math.round(s.diff(e,"seconds")/60)):e.isBefore(i)&&(c=Math.round(i.diff(e,"seconds")/60)),{isWorking:d,progress:parseFloat(p.toFixed(2)),remainingMinutes:c,remainingTimeText:this.formatRemainingTime(c),isNextDay:n}}updateDisplay(){var i;let t=(i=l.getState().moment)==null?void 0:i.clone();if(!t)return;let e=this.calculateWorkProgress(t);this.titleEl.setText(e.isWorking?o("working_time_progress_working","\u5DE5\u4F5C\u4E2D"):o("working_time_progress_resting","\u4F11\u606F\u4E2D")),this.container.dataset.status=e.isWorking?"working":"resting",this.timeRemainingEl.setText(e.isWorking?`${o("working_time_progress_working_is_remaining","\u5269\u4F59")} ${e.remainingTimeText}`:""),e.isWorking&&this.setProgress(100-e.progress)}onload(){this.titleEl=this.container.createDiv({cls:"dms-sidebar-working-time-title"}),this.timeRemainingEl=this.container.createDiv({cls:"dms-sidebar-working-time-remaining"}),this.setDirection("vertical","end"),this.updateDisplay(),this.subscription.push(l.subscribe("minute",()=>{this.updateDisplay()}))}onunload(){this.subscription.forEach(t=>t())}};var k=require("obsidian");var J=class extends m{constructor(t,e,i){super(t,e,i)}onload(){let t=this.container.createEl("div",{cls:"dms-sidebar-random-notes-header"});t.createEl("h3",{text:o("random_notes_title","\u968F\u673A\u7B14\u8BB0")});let e=t.createEl("a",{cls:"dms-sidebar-random-notes-refresh"});(0,k.setIcon)(e,"refresh-cw"),(0,k.setTooltip)(e,o("random_notes_refresh_tooltip","\u5237\u65B0"),{placement:"top"}),this.contentEl=this.container.createDiv({cls:"dms-sidebar-random-notes-content"});let i=this.widget.code?this.widget.code.split(`
`).filter(s=>s.trim()!==""):[];this.files=this.app.vault.getFiles().filter(s=>s.extension!=="md"?!1:!i.some(n=>s.path.startsWith(n))),this.renderNotesList(),e.addEventListener("click",()=>{this.renderNotesList()})}renderNotesList(){this.contentEl.empty();let t=[],e=Math.min(5,this.files.length),i=new Set;for(;t.length<e;){let s=Math.floor(Math.random()*this.files.length);i.has(s)||(i.add(s),t.push(this.files[s]))}t.forEach(s=>{let n=this.contentEl.createDiv({cls:"dms-sidebar-random-notes-item"});(0,k.setIcon)(n,"file-text");let d=this.createLink(s.path,s.basename,n,["dms-sidebar-random-notes-title"]),p=window.moment(s.stat.ctime),c=window.moment(s.stat.mtime);(0,k.setTooltip)(d,`${p.format("YYYY-MM-DD HH:mm")} / ${c.format("YYYY-MM-DD HH:mm")}`,{placement:"top"})})}};var ct=require("obsidian");var X=class extends S{constructor(t,e,i){super(t,e,i);this.subscriptions=[]}async getBatteryStatus(){let t={level:100,charging:!1};try{if(!("getBattery"in navigator))return console.warn("Battery API not supported"),t;let e=await navigator.getBattery();return{level:Math.floor(e.level*100),charging:e.charging}}catch(e){return console.error("\u83B7\u53D6\u7535\u6C60\u72B6\u6001\u5931\u8D25:",e),t}}async updateBatteryDisplay(){let{level:t,charging:e}=await this.getBatteryStatus();this.setProgress(t),this.batteryPercent.setText(`${t}%`),this.batteryPercent.dataset.level=`${t}%`,e?((0,ct.setIcon)(this.batteryIcon,"battery-charging"),this.batteryIcon.dataset.status="charging"):((0,ct.setIcon)(this.batteryIcon,"battery"),this.batteryIcon.dataset.status="discharging")}onload(){this.batteryIcon=this.container.createDiv({cls:"dms-sidebar-battery-icon"}),this.batteryPercent=this.container.createDiv({cls:"dms-sidebar-battery-percent"}),this.updateBatteryDisplay();let t=l.subscribe("minute",()=>{this.updateBatteryDisplay()});this.subscriptions.push(t)}onunload(){this.subscriptions.forEach(t=>t()),this.subscriptions=[]}};var u=require("obsidian");var wt=require("obsidian");function H(a,r){class t extends wt.Modal{constructor(s,n){super(s);this.subscription=[];this.value=n.value,this.options=n}onOpen(){let{contentEl:s}=this;s.addClass("dms-sidebar-simple-edit-modal"),s.empty(),this.options.title&&s.createEl("h3",{text:this.options.title}),this.input=s.createEl("input",{type:"text",value:this.value,cls:"dms-sidebar-simple-edit-modal-input",attr:{placeholder:this.options.placeholder||""}});let n=s.createEl("button",{text:this.options.saveButtonText||o("simple_edit_modal_save_button_title","\u4FDD\u5B58")}),d=this.onSubmit.bind(this);n.addEventListener("click",d),this.subscription.push(()=>n.removeEventListener("click",d));let p=c=>{c.key==="Enter"&&this.onSubmit()};this.input.addEventListener("keydown",p),this.subscription.push(()=>this.input.removeEventListener("keydown",p)),setTimeout(()=>this.input.focus(),0)}onSubmit(){this.value=this.input.value,this.options.onSubmit(this.value),this.close()}onClose(){let{contentEl:s}=this;s.empty(),this.subscription.forEach(n=>n())}}new t(a,r).open()}var K=class extends m{constructor(t,e,i){super(t,e,i);this.recordData=[];this.noteFile=null;this.subscription=[];this.config=this.parseConfig(e.code)}parseConfig(t){let e={title:o("daily_event_record_default_title","\u6BCF\u65E5\u4E8B\u4EF6\u8BB0\u5F55"),note:""};if(!t||t.trim()==="")return e;try{let i=(0,u.parseYaml)(t);return{title:i.title||e.title,note:i.note||e.note}}catch(i){return console.error("\u89E3\u6790YAML\u5931\u8D25:",i),e}}async onload(){if(this.container.addClass("dms-sidebar-daily-event-record"),this.container.createEl("h3",{cls:"dms-sidebar-daily-event-record-title"}).createEl("a",{cls:["internal-link"],text:this.config.title,href:this.config.note,attr:{rel:"noopener",target:"_blank"}}),!this.config.note){this.container.createEl("div",{text:o("daily_event_record_no_note","\u8BF7\u5728\u914D\u7F6E\u4E2D\u6307\u5B9A\u8BB0\u5F55\u7B14\u8BB0"),cls:"dms-sidebar-daily-event-record-error"});return}await this.loadNoteData(),this.createDotMatrix(),this.createTodayRecordList(),this.createAddButton()}async loadNoteData(){try{let t=this.app.vault.getAbstractFileByPath(this.config.note);!t||!(t instanceof u.TFile)?this.noteFile=await this.app.vault.create(this.config.note,""):this.noteFile=t,this.noteFile||(this.noteFile=await this.app.vault.create(this.config.note,""));let e=await this.app.vault.read(this.noteFile);this.parseRecordData(e)}catch(t){console.error("\u52A0\u8F7D\u7B14\u8BB0\u6570\u636E\u5931\u8D25:",t),this.container.createEl("div",{text:o("daily_event_record_load_error","\u52A0\u8F7D\u8BB0\u5F55\u6570\u636E\u5931\u8D25"),cls:"dms-sidebar-daily-event-record-error"})}}parseRecordData(t){this.recordData=[];let e=t.split(`
`).map(i=>i.trim()).filter(i=>i!=="").filter(i=>/^[-*]\s+\d{2}-\d{2}\s+\/\s+/.test(i)).map(i=>i.replace(/^[-*]\s+/,""));for(let i of e){let s=i.split("/");if(s.length!==2)continue;let n=s[0].trim();if(!/^\d{2}-\d{2}$/.test(n))continue;let p=s[1].split("|").map(c=>c.trim()).filter(c=>c!=="");this.recordData.push({date:n,times:p})}}createDotMatrix(){let t=this.container.createDiv({cls:"dms-sidebar-daily-event-record-matrix"}),e=this.recordData.slice(-36);for(let i of e){let s=t.createDiv({cls:"dms-sidebar-daily-event-record-column"});s.createDiv({text:i.date,cls:"dms-sidebar-daily-event-record-date",attr:{"data-date":i.date}});for(let n of i.times){let d=s.createDiv({cls:"dms-sidebar-daily-event-record-dot"});(0,u.setTooltip)(d,`${n}`)}}}createTodayRecordList(){let t=window.moment().format("MM-DD");this.container.createEl("h4",{text:`${o("daily_event_record_today_title","\u4ECA\u65E5\u8BB0\u5F55")} (${t})`,cls:"dms-sidebar-daily-event-record-list-title"});let e=this.container.createDiv({cls:"dms-sidebar-daily-event-record-list"}),i=this.recordData.find(s=>s.date===t);if(i&&i.times.length>0)for(let s=0;s<i.times.length;s++){let n=i.times[s],d=e.createEl("div",{cls:"dms-sidebar-daily-event-record-list-item"}),p=d.createEl("span",{text:`\u2705 ${n}`,cls:"dms-sidebar-daily-event-record-list-item-text"}),c=d.createEl("div",{cls:"dms-sidebar-daily-event-record-list-item-buttons"}),h=c.createEl("div",{cls:"dms-sidebar-daily-event-record-edit-button"});(0,u.setIcon)(h,"pencil"),(0,u.setTooltip)(h,o("daily_event_record_edit_tooltip","\u7F16\u8F91\u8BB0\u5F55"));let f=c.createEl("div",{cls:"dms-sidebar-daily-event-record-delete-button"});(0,u.setIcon)(f,"trash"),(0,u.setTooltip)(f,o("daily_event_record_delete_tooltip","\u5220\u9664\u8BB0\u5F55"));let y=()=>this.editRecord(s);h.addEventListener("click",y),this.subscription.push(()=>h.removeEventListener("click",y));let b=()=>this.deleteRecord(s);f.addEventListener("click",b),this.subscription.push(()=>f.removeEventListener("click",b))}else e.createEl("li",{text:o("daily_event_record_no_records","\u65E0\u8BB0\u5F55"),cls:"dms-sidebar-daily-event-record-list-item dms-sidebar-daily-event-record-list-item-empty"})}createAddButton(){let e=this.container.createDiv({cls:"dms-sidebar-daily-event-record-button-container"}).createEl("button",{text:o("daily_event_record_add_button","\u6DFB\u52A0\u8BB0\u5F55"),cls:"dms-sidebar-daily-event-record-add-button"}),i=this.addRecord.bind(this);e.addEventListener("click",i),this.subscription.push(()=>e.removeEventListener("click",i))}async saveAndReloadData(t,e,i){if(!this.noteFile)return!1;try{let s=this.recordData.map(n=>`- ${n.date} / ${n.times.join(" | ")}`).join(`
`);return await this.app.vault.modify(this.noteFile,s),this.container.empty(),await this.onload(),t&&new u.Notice(t),!0}catch(s){return console.error(i?`${i}:`:"\u4FDD\u5B58\u6570\u636E\u5931\u8D25:",s),e&&new u.Notice(e),!1}}async handleAddRecord(t){if(!t||t.trim()===""||(t=t.trim(),!this.validateTimeFormat(t)))return;await this.loadNoteData();let e=window.moment().format("MM-DD"),i=this.recordData.findIndex(s=>s.date===e);i>=0?this.recordData[i].times.push(t):this.recordData.push({date:e,times:[t]}),await this.saveAndReloadData(o("daily_event_record_add_success","\u8BB0\u5F55\u5DF2\u6DFB\u52A0"),o("daily_event_record_add_error","\u6DFB\u52A0\u8BB0\u5F55\u5931\u8D25"),"\u6DFB\u52A0\u8BB0\u5F55\u5931\u8D25")}async addRecord(){let t=window.moment().format("HH:mm");H(this.app,{value:t+" ",placeholder:"HH:mm",onSubmit:this.handleAddRecord.bind(this)})}async handleEditRecord(t,e,i){if(!i||i.trim()===""||i===e||!this.validateTimeFormat(i))return;await this.loadNoteData();let s=window.moment().format("MM-DD"),n=this.recordData.findIndex(d=>d.date===s);n<0||!this.noteFile||(this.recordData[n].times[t]=i,await this.saveAndReloadData(o("daily_event_record_edit_success","\u8BB0\u5F55\u5DF2\u66F4\u65B0"),o("daily_event_record_edit_error","\u7F16\u8F91\u8BB0\u5F55\u5931\u8D25"),"\u7F16\u8F91\u8BB0\u5F55\u5931\u8D25"))}validateTimeFormat(t){return/^([01]\d|2[0-3]):([0-5]\d)/.test(t)?!0:(new u.Notice(o("daily_event_record_invalid_time","\u65E0\u6548\u7684\u65F6\u95F4\u683C\u5F0F\uFF0C\u8BF7\u4F7F\u7528 HH:mm \u683C\u5F0F")),!1)}async editRecord(t){let e=window.moment().format("MM-DD");await this.loadNoteData();let i=this.recordData.findIndex(n=>n.date===e);if(i<0||!this.noteFile)return;let s=this.recordData[i].times[t];H(this.app,{value:s+(/^\d+:\d+$/.test(s)?" ":""),placeholder:"HH:mm",onSubmit:n=>{this.handleEditRecord(t,s,n.trim())}})}async deleteRecord(t){let e=window.moment().format("MM-DD");await this.loadNoteData();let i=this.recordData.findIndex(n=>n.date===e);if(i<0||!this.noteFile)return;let s=this.recordData[i].times[t];confirm(o("daily_event_record_delete_confirm",`\u786E\u5B9A\u8981\u5220\u9664 ${s} \u7684\u8BB0\u5F55\u5417\uFF1F`))&&(this.recordData[i].times.splice(t,1),this.recordData[i].times.length===0&&this.recordData.splice(i,1),await this.saveAndReloadData(o("daily_event_record_delete_success","\u8BB0\u5F55\u5DF2\u5220\u9664"),o("daily_event_record_delete_error","\u5220\u9664\u8BB0\u5F55\u5931\u8D25"),"\u5220\u9664\u8BB0\u5F55\u5931\u8D25"))}async onunload(){this.subscription.forEach(t=>t())}};var C=require("obsidian");var Pt=a=>{let r=a.split(":").map(e=>e.trim()).map(Number),t=0;for(let e=0;e<r.length;e++)t+=r[r.length-1-e]*Math.pow(60,e);return isNaN(t)?0:t},F=a=>String(a).padStart(2,"0"),vt=a=>{let r=Math.floor(a/3600),t=Math.floor(a%3600/60),e=a%60;return r>0?`${F(r)}:${F(t)}:${F(e)}`:`${F(t)}:${F(e)}`},tt=class extends S{constructor(t,e,i){super(t,e,i);this.timer=null;this.running=!1;this.remaining=0;this.initial=0;this.presets=[];this.getConfig()}getConfig(){this.presets=[],this.widget.code&&(this.presets=this.widget.code.split(`
`).map(t=>Pt(t.trim())).filter(t=>t>0)),this.presets.length===0&&(this.presets=[60,180,300])}freshTimer(){this.remaining>0&&(this.remaining--,this.updateDisplay(),this.remaining===0&&(this.stopTimer(),this.beep()))}updateDisplay(){this.displayEl.setText(vt(this.remaining)),this.container.dataset.status=this.running?"running":"paused";let t=!this.running&&this.remaining===this.initial?0:this.remaining/this.initial*100;this.setProgress(t)}startTimer(){this.running||this.remaining<=0||(this.running=!0,this.updateDisplay(),(0,C.setIcon)(this.startPauseBtn,"pause"),(0,C.setIcon)(this.resetBtn,"square"),this.timer=l.subscribe("second",this.freshTimer.bind(this)))}pauseTimer(){this.running&&(this.running=!1,this.updateDisplay(),(0,C.setIcon)(this.startPauseBtn,"play"),(0,C.setIcon)(this.resetBtn,"reset"),this.timer&&(this.timer(),this.timer=null))}stopTimer(){this.pauseTimer(),this.remaining=0,this.updateDisplay()}resetTimer(){this.pauseTimer(),this.remaining=this.initial,this.updateDisplay()}setTimer(t){this.pauseTimer(),this.initial=t,this.remaining=t,this.updateDisplay()}beep(){let t=new AudioContext,e=t.createOscillator();e.type="sine",e.frequency.value=440,e.connect(t.destination),e.start(),setTimeout(()=>e.stop(),500)}onload(){this.initial=this.presets[0],this.remaining=this.initial,this.displayEl=this.container.createDiv({cls:"dms-sidebar-countdown-timer-display"}),this.updateDisplay();let t=this.container.createDiv({cls:"dms-sidebar-countdown-timer-btn-row"});this.startPauseBtn=t.createEl("div",{cls:"dms-sidebar-countdown-timer-btn"}),(0,C.setIcon)(this.startPauseBtn,"play"),this.resetBtn=t.createEl("div",{cls:"dms-sidebar-countdown-timer-btn"}),(0,C.setIcon)(this.resetBtn,"reset"),this.startPauseBtn.onclick=()=>{this.running?this.pauseTimer():this.startTimer()},this.resetBtn.onclick=()=>this.resetTimer(),this.presetContainer=this.container.createDiv({cls:"dms-sidebar-countdown-timer-presets"}),this.presets.forEach((e,i)=>{let s=this.presetContainer.createEl("div",{cls:"dms-sidebar-countdown-timer-preset-btn"});e===this.initial&&s.classList.add("dms-sidebar-countdown-timer-preset-current"),s.setText(vt(e)),s.onclick=()=>{this.presetContainer.querySelectorAll(".dms-sidebar-countdown-timer-preset-current").forEach(n=>{n.classList.remove("dms-sidebar-countdown-timer-preset-current")}),s.classList.add("dms-sidebar-countdown-timer-preset-current"),this.setTimer(e)}})}onunload(){this.pauseTimer()}};var bt={header_1:M,header_3:M,digital_clock:$,time_progress:O,week_calendar:V,month_calendar:Y,countdown_day:j,text:B,image:z,quick_nav:U,year_points:G,file_stats:Q,working_time_progress:Z,random_notes:J,battery_status:X,daily_event_record:K,countdown_timer:tt},et=Object.keys(bt),St=(a,r,t)=>new(bt[r.type]||P)(a,r,t);var Ct=["card","stacked_cards"],it={},Tt={};Object.keys(Tt).forEach(a=>{Tt[a].forEach(t=>{it[t]||(it[t]=[]),it[t].push(a)})});var Et=a=>a.reduce((r,t)=>(r[t]=t,r),{}),$t=a=>Et(["default"].concat(Ct,it[a]||[],["custom","base"])),Dt=Et(Ct.concat(["base"])),xt=et.reduce((a,r)=>(a[r]=$t(r),a),{});var v=require("obsidian");var st=class extends v.Modal{constructor(t){super(t);this.hasChanged=!1;this.setTitle(o("edit_widget_modal_title","\u7F16\u8F91\u5C0F\u90E8\u4EF6")),this.containerEl.classList.add("dms-widget-edit-modal"),this.types=et}setData(t,e){this.widget=t,this.setback=e,this.hasChanged=!1,this.initTypeDesc()}isCustomType(){return!this.types.includes(this.widget.type)}isCustomStyle(){return this.widget.style==="custom"||!Object.keys(this.getWidgetStyleList(this.widget.type)).includes(this.widget.style)}getWidgetStyleList(t){return xt[t]||{default:"default",custom:"custom",base:"base"}}initStyleComponents(){this.widget.style||(this.widget.style="default")}initTypeDesc(){let t=this.isCustomType()?"custom":this.widget.type;this.typeDescFragment=document.createDocumentFragment(),this.typeDescFragment.createEl("p",{text:o("edit_widget_modal_widget_type_desc","\u5C0F\u90E8\u4EF6\u7C7B\u578B")});let e=this.typeDescFragment.createEl("p");this.widgetTypeName=e.createEl("strong",{text:o("widget_type_"+t,"")||t}),e.createEl("span",{text:": "}),this.widgetTypeDesc=e.createEl("span",{text:o("widget_type_"+t+"_desc","")||""})}onOpen(){let{contentEl:t}=this;this.contentEl.empty(),this.initStyleComponents(),new v.Setting(t).setName(o("edit_widget_modal_widget_title","\u5C0F\u90E8\u4EF6\u6807\u9898")).setDesc(o("edit_widget_modal_widget_title_desc","\u8BF7\u8F93\u5165\u5C0F\u90E8\u4EF6\u7684\u6807\u9898")).addText(s=>s.setPlaceholder(o("edit_widget_modal_widget_title_placeholder","\u8BF7\u8F93\u5165\u6807\u9898")).setValue(this.widget.title).onChange(n=>{this.widget.title=n,this.hasChanged=!0})),this.typeChoice=new v.Setting(t).setName(o("edit_widget_modal_widget_type","\u5C0F\u90E8\u4EF6\u7C7B\u578B")).setDesc(this.typeDescFragment).addDropdown(s=>s.addOptions(this.types.concat(["custom"]).reduce((n,d)=>(n[d]=o("widget_type_"+d,"")||d,n),{})).setValue(this.isCustomType()?"custom":this.widget.type).onChange(n=>{n==="custom"?(e.setDisabled(!1),this.customTypeComponent.setValue(this.widget.type)):(e.setDisabled(!0),this.widget.type=n),this.hasChanged=!0,this.refreshTypeDesc(n),this.refreshStyleList()}));let e=new v.Setting(t).setName(o("edit_widget_modal_widget_custom_type","\u81EA\u5B9A\u4E49\u5C0F\u90E8\u4EF6\u7C7B\u578B")).setDesc(o("edit_widget_modal_widget_custom_type_desc","\u5982\u679C\u60A8\u9009\u62E9\u4E86\u81EA\u5B9A\u4E49\u7C7B\u578B\uFF0C\u8BF7\u5728\u6B64\u8F93\u5165\u5C0F\u90E8\u4EF6\u7C7B\u578B\u540D\u79F0")).setClass("dms-widget-custom-type").setDisabled(!this.isCustomType()).addText(s=>(this.customTypeComponent=s,s.setPlaceholder(o("edit_widget_modal_widget_custom_type_placeholder","\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u5C0F\u90E8\u4EF6\u7C7B\u578B")).setValue(this.widget.type).onChange(n=>{this.widget.type=n,this.hasChanged=!0,this.refreshStyleList()})));new v.Setting(t).setName(o("edit_widget_modal_widget_style","\u5C0F\u90E8\u4EF6\u6837\u5F0F")).setDesc(o("edit_widget_modal_widget_style_desc","\u8BF7\u9009\u62E9\u5C0F\u90E8\u4EF6\u7684\u6837\u5F0F")).addDropdown(s=>{this.styleChoice=s,s.addOptions(this.getWidgetStyleList(this.widget.type)).setValue(this.isCustomStyle()?"custom":this.widget.style).onChange(n=>{n==="custom"?(i.setDisabled(!1),this.customStyleComponent.setValue(this.widget.style||"default")):(i.setDisabled(!0),this.widget.style=n),this.hasChanged=!0})});let i=new v.Setting(t).setName(o("edit_widget_modal_widget_custom_style","\u81EA\u5B9A\u4E49\u5C0F\u90E8\u4EF6\u6837\u5F0F")).setDesc(o("edit_widget_modal_widget_custom_style_desc","\u5982\u679C\u60A8\u9009\u62E9\u4E86\u81EA\u5B9A\u4E49\u6837\u5F0F\uFF0C\u8BF7\u5728\u6B64\u8F93\u5165\u5C0F\u90E8\u4EF6\u6837\u5F0F\u540D\u79F0")).setClass("dms-widget-custom-style").setDisabled(this.widget.style!=="custom").addText(s=>(this.customStyleComponent=s,s.setPlaceholder(o("edit_widget_modal_widget_custom_style_placeholder","\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u5C0F\u90E8\u4EF6\u6837\u5F0F")).setValue(this.widget.style||"default").onChange(n=>{this.widget.style=n,this.hasChanged=!0})));new v.Setting(t).setName(o("edit_widget_modal_widget_code","\u5C0F\u90E8\u4EF6\u4EE3\u7801")).setDesc(o("edit_widget_modal_widget_code_desc","\u8BF7\u8F93\u5165\u5C0F\u90E8\u4EF6\u7684\u4EE3\u7801\u5185\u5BB9")).setClass("dms-widget-code").addTextArea(s=>s.setPlaceholder(o("edit_widget_modal_widget_code_placeholder","\u8BF7\u8F93\u5165\u5C0F\u90E8\u4EF6\u4EE3\u7801")).setValue(this.widget.code).onChange(n=>{this.widget.code=n,this.hasChanged=!0}))}refreshTypeDesc(t=this.widget.type){this.widgetTypeName.setText(o("widget_type_"+t,"")||t),this.widgetTypeDesc.setText(o("widget_type_"+t+"_desc","")||"")}refreshStyleList(){this.styleChoice.selectEl.empty(),this.styleChoice.addOptions(this.getWidgetStyleList(this.widget.type)),this.customStyleComponent.setDisabled(!this.isCustomStyle())}onClose(){let{contentEl:t}=this;t.empty(),this.hasChanged&&this.setback(this.widget)}};var rt=class extends _.PluginSettingTab{constructor(t,e){super(t,e);this.sidebarListContainer=null;this.widgetListContainers={};this.plugin=e,this.editModal=new st(t)}display(){let{containerEl:t}=this;t.empty(),t.classList.add("dms-widget-sidebar-settings"),new _.Setting(t).setName(o("widget_style_title","\u5C0F\u90E8\u4EF6\u4FA7\u8FB9\u680F\u6837\u5F0F")).setHeading(),new _.Setting(t).setName(o("widget_style_selector_title","\u9009\u62E9\u4FA7\u8FB9\u680F\u6837\u5F0F")).setDesc(o("widget_style_selector_desc","\u9009\u62E9\u5C0F\u90E8\u4EF6\u4FA7\u8FB9\u680F\u7684\u6837\u5F0F")).addDropdown(e=>e.addOptions(Dt).setValue(w.getState().sidebarStyle).onChange(async i=>{await this.saveSettings({sidebarStyle:i},"global")})),new _.Setting(t).setName(o("sidebar_list_title","\u5C0F\u90E8\u4EF6\u4FA7\u8FB9\u680F\u5217\u8868")).setHeading(),this.sidebarListContainer=t.createEl("div",{cls:"dms-sidebar-list-container"}),this.refreshSidebarList(),new _.Setting(t).addButton(e=>e.setButtonText(o("add_sidebar_button_title","\u6DFB\u52A0\u65B0\u6302\u4EF6\u4FA7\u8FB9\u680F")).setCta().onClick(async()=>{let i=new Date().getTime().toString(36),s={title:o("new_view_title","\u65B0\u6302\u4EF6\u4FA7\u8FB9\u680F"),viewType:i,widgets:[]};await this.saveSingleSidebarSettings(s,i),this.refreshSidebarList()}))}refreshSidebarList(){var e;if(!this.sidebarListContainer)return;(e=this.sidebarListContainer)==null||e.empty();let t=g.getState();Object.keys(t).forEach(i=>{var h;let s=t[i],n=(h=this.sidebarListContainer)==null?void 0:h.createEl("div",{cls:"dms-sidebar-item-list"});if(!n)return;let d=n.createEl("h3",{cls:"dms-sidebar-item-header"}),p=d.createEl("span",{text:s.title});new _.ButtonComponent(d).setIcon("edit").setTooltip(o("sidebar_edit_button_tooltip","\u7F16\u8F91\u4FA7\u8FB9\u680F")).onClick(()=>{H(this.app,{value:s.title,onSubmit:async f=>{await this.saveSingleSidebarSettings({...s,title:f}),p.setText(f)}})}),i!="default"&&new _.ButtonComponent(d).setIcon("trash").setWarning().setTooltip(o("sidebar_delete_button_tooltip","\u5220\u9664\u4FA7\u8FB9\u680F")).onClick(async()=>{var y;if(i==="default"){new _.Notice(o("delete_default_sidebar_notice","\u65E0\u6CD5\u5220\u9664\u9ED8\u8BA4\u4FA7\u8FB9\u680F"));return}await confirm(o("delete_sidebar_button_confirm","\u786E\u8BA4\u5220\u9664\u6B64\u4FA7\u8FB9\u680F\uFF1F"))&&(await this.saveSingleSidebarSettings(void 0,i),(y=this.sidebarListContainer)==null||y.removeChild(n),delete this.widgetListContainers[i])});let c=n.createEl("div",{cls:"dms-widget-list-container"});this.widgetListContainers[i]=c,this.refreshWidgetList(i),new _.Setting(n).addButton(f=>f.setButtonText(o("add_widget_button_title","\u6DFB\u52A0\u65B0\u5C0F\u90E8\u4EF6")).setCta().onClick(async()=>{let y={title:`Widget-${s.widgets.length+1}`,type:"text",style:"default",code:""};s.widgets.push(y),await this.saveSingleSidebarSettings(s),this.refreshWidgetList(i),this.editModal.setData(y,b=>this.saveWidgetConfig(b,i,s.widgets.length-1)),this.editModal.open()}))})}refreshWidgetList(t){let e=this.widgetListContainers[t];e&&(e.empty(),g.getState()[t].widgets.forEach((s,n)=>{this.addWidgetListItem(s,n,t)}))}addWidgetListItem(t,e,i){if(!this.widgetListContainers[i])return;let s=this.widgetListContainers[i].createEl("div",{cls:"dms-widget-item-setting"});s==null||s.createEl("span",{text:t.title}),new _.ButtonComponent(s).setIcon("up-chevron-glyph").setTooltip(o("move_up_button_title","\u5411\u4E0A\u79FB\u52A8\u5C0F\u6302\u4EF6")).setDisabled(e===0).onClick(()=>this.moveWidgetUp(i,e)),new _.ButtonComponent(s).setIcon("down-chevron-glyph").setTooltip(o("move_down_button_title","\u5411\u4E0B\u79FB\u52A8\u5C0F\u6302\u4EF6")).setDisabled(e===g.getState()[i].widgets.length-1).onClick(()=>this.moveWidgetDown(i,e)),new _.ButtonComponent(s).setIcon("edit").setTooltip(o("edit_widget_button_title","\u7F16\u8F91\u5C0F\u6302\u4EF6")).onClick(()=>this.editWidget(i,e)),new _.ButtonComponent(s).setIcon("trash").setWarning().setTooltip(o("delete_widget_button_title","\u5220\u9664\u5C0F\u6302\u4EF6")).onClick(()=>this.deleteWidget(i,e))}async moveWidgetUp(t,e){let i=g.getState()[t];[i.widgets[e],i.widgets[e-1]]=[i.widgets[e-1],i.widgets[e]],await this.saveSingleSidebarSettings(i),this.refreshWidgetList(t)}async moveWidgetDown(t,e){let i=g.getState()[t];[i.widgets[e],i.widgets[e+1]]=[i.widgets[e+1],i.widgets[e]],await this.saveSingleSidebarSettings(i),this.refreshWidgetList(t)}editWidget(t,e){this.editModal.setData(g.getState()[t].widgets[e],i=>this.saveWidgetConfig(i,t,e)),this.editModal.open()}async deleteWidget(t,e){if(!await confirm(o("delete_widget_button_title_confirm","\u786E\u8BA4\u5220\u9664\u6B64\u5C0F\u6302\u4EF6\uFF1F")))return;let s=g.getState()[t];s.widgets.splice(e,1),await this.saveSingleSidebarSettings(s),this.refreshWidgetList(t)}async saveWidgetConfig(t,e,i){let s=g.getState()[e];s.widgets[i]=t,await this.saveSingleSidebarSettings(s),this.refreshWidgetList(e)}async saveSettings(t,e="all"){e==="all"&&(w.updateState(t.global),g.updateState(t.sidebars)),e==="global"&&w.updateState(t),e==="sidebars"&&g.updateState(t);let i={configVersion:2,global:w.getState(),sidebars:g.getState()};this.plugin.saveData(i)}async saveSingleSidebarSettings(t,e){if(e||(e=t==null?void 0:t.viewType),!e){console.error("Key is required to save sidebar settings");return}let i={};i[e]=t,await this.saveSettings(i,"sidebars")}};var kt=require("obsidian");var L=a=>`DMS-Widgets-Sidebar-View-${a}`,ot=class extends kt.ItemView{constructor(t,e){super(t);this.widgets=[];this.container=this.containerEl.children[1],this.viewType=e,w.subscribe("",()=>{this.refreshView()}),g.subscribe(e,()=>{this.refreshView()}),this.sidebarConfig=g.getState()[this.viewType],this.globalConfig=w.getState()}getViewType(){return L(this.viewType)}getDisplayText(){return this.sidebarConfig.title}getIcon(){return"notebook-tabs"}async onOpen(){await this.refreshView(),this.container.addEventListener("click",this.linkClickHandler.bind(this))}async onClose(){this.container.removeEventListener("click",this.linkClickHandler.bind(this)),this.unloadWidgets()}onResize(){this.container.setAttr("style",`--dms-sidebar-width: ${this.container.clientWidth+"px"}`)}async refreshView(){if(this.unloadWidgets(),this.sidebarConfig=g.getState()[this.viewType],this.globalConfig=w.getState(),!this.sidebarConfig){this.unload();return}this.container.empty(),this.container.classList.add("dms-widget-sidebar"),this.container.setAttr("data-widget-sidebar-style",this.globalConfig.sidebarStyle),this.container.setAttr("data-widget-sidebar-view-type",this.sidebarConfig.viewType),this.onResize();for(let[t,e]of this.sidebarConfig.widgets.entries()){let i=this.container.createDiv({cls:"dms-widget-container",attr:{"data-widget-style":!e.style||e.style==="default"?this.globalConfig.sidebarStyle:e.style,"data-widget-type":e.type,"data-widget-index":t.toString()}}),s=St(i,e,this.app);this.widgets.push(s),s.load()}}unloadWidgets(){this.widgets.forEach(t=>t.unload()),this.widgets=[]}linkClickHandler(t){if(t.target instanceof HTMLElement&&t.target.tagName==="A"&&t.target.classList.contains("internal-link")){t.preventDefault();let e=t.target.getAttribute("href");e&&(/^(\w+):\/\//i.test(e)?window.open(e,"_blank","noopener"):this.app.workspace.openLinkText(e,""))}}};var nt=class extends E.Plugin{constructor(){super(...arguments);this.sidebarViewList={};this.listeners=[]}async onload(){this.registerTimer(),await this.loadSettings(),this.app.workspace.onLayoutReady(()=>{this.refreshSidebars(),this.listeners.push(g.subscribe("",()=>{this.refreshSidebars()})),this.addRibbonIcon("notebook-tabs",o("ribbon_button_title","\u6253\u5F00\u9ED8\u8BA4\u6302\u4EF6\u4FA7\u8FB9\u680F"),()=>{this.activateView("default")}),this.addSettingTab(new rt(this.app,this))})}onunload(){this.unregisterTimer(),this.listeners.forEach(t=>t())}async activateView(t){let{workspace:e}=this.app,i=null,s=e.getLeavesOfType(L(t));if(s.length>0)i=s[0];else{if(i=e.getRightLeaf(!1),!i){new E.Notice(o("cannot_create_leaf","\u65E0\u6CD5\u521B\u5EFA\u65B0\u7684\u4FA7\u8FB9\u680F\u89C6\u56FE"));return}await i.setViewState({type:L(t),active:!0})}e.revealLeaf(i)}refreshSidebars(){let t=g.getState();for(let e in this.sidebarViewList)t[e]||(this.app.workspace.detachLeavesOfType(L(e)),this.removeCommand(this.sidebarViewList[e].commandID),delete this.sidebarViewList[e]);for(let e in this.sidebarViewList){let i=t[e];if(i&&i.title!==this.sidebarViewList[e].title){let s=this.sidebarViewList[e].commandID;this.removeCommand(s),this.addCommand({id:s,name:o("command_active_sidebar","\u6FC0\u6D3B\u4FA7\u8FB9\u680F")+`: ${i.title}`,callback:()=>{this.activateView(e)}}),this.sidebarViewList[e].title=i.title}}for(let e in t)if(!this.sidebarViewList[e]){this.registerView(L(e),s=>new ot(s,e));let i=`dms-widget-sidebar-${e}`;this.addCommand({id:i,name:o("command_active_sidebar","\u6FC0\u6D3B\u4FA7\u8FB9\u680F")+`: ${t[e].title}`,callback:()=>{this.activateView(e)}}),this.sidebarViewList[e]={title:t[e].title,commandID:i}}}async loadSettings(){let t=await this.loadData();t&&"widgets"in t&&(t=_t(t));let e=Object.assign({},W,t);w.updateState(e.global),g.updateState(e.sidebars)}registerTimer(){this.unregisterTimer();let t=(0,E.moment)(),e={second:t.second(),minute:t.minute(),hour:t.hour(),day:t.date(),moment:t};l.updateState(e);let i=this.registerInterval(window.setInterval(()=>{var y;let s=(0,E.moment)(),n=s.second(),d=s.minute(),p=s.hour(),c=(y=l.getState().moment)==null?void 0:y.clone(),h=c&&s.diff(c)>2e3,f={second:n,moment:s,...h||n===0?{minute:d}:{},...h||n===0&&d===0?{hour:p}:{},...h||n===0&&d===0&&p===0?{day:s.date()}:{}};l.updateState(f)},1e3));l.updateState({id:i})}unregisterTimer(){l.getState().id&&l.reset()}};
